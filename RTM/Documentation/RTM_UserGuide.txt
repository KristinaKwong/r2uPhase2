# TransLink Regional Transportation Model - Phase 3 Userguide

# Introduction

# Model Format

The model is now delivered as a collection of plain text files with an initial script to build the emmebank
in which the model is run. An emme project file (.emp) is provided to reference all required folders and to link
in an empty, minimally sized databank in the Template/ folder. This is only provided to allow emme modeller tools to
run before an RTM phase 3 databank has been initialized.

The BaseNetworks/ folder contains all of the files required to build a databank and contains:
 - Network batchin files for horizon years 2011, 2015, 2030 and 2045
 - Initial demand matrices to generate costs on the network
 - External demand matrices
 - Definitions of ensembles, modes, transit vehicles

The Inputs/ folder within BaseNetworks contains the default model assumptions for each horizon year, a copy
of this folder is placed with each databank ini

## Text Format


### csv files
### Base Networks Folder


### Documentation

## Script Relocation

All file references have been updated to be relative to the provided emme project file. The only exception to this are
references to modeller python files in the emme toolboxes. A batch file has been provided in Scripts/relocate_tools.bat to
link the toolboxes to the appropriate file if the project is moved. This batch file must also be run when unpacking the
initial files from a zip file to the hard disk.

If the following error is encountered when running this script:

~~~
Traceback (most recent call last):
  File "toolbox_modify.py", line 155, in <module>
    set_tools_to_current_root(toolbox_path, root_dir_name)
  File "toolbox_modify.py", line 129, in set_tools_to_current_root
    with ToolboxWrap(toolbox_path) as toolbox:
  File "toolbox_modify.py", line 60, in __init__
    self.documents = self.connection.execute('select * from documents').fetchall()
sqlite3.DatabaseError: file is encrypted or is not a database
~~~

It is likely that a Modeller instance is running and has locked the toolbox file. Close all Modeller instances and run the
script again.


# Databank Initialization

Once the text files have been unpacked and the scripts relocated, open the emme modeller toolbox and run the InitEmmebank tool,
this will allow an RTM Phase 3 Databank to be initialized and linked into the current project. The tool requires a folder name which
will be created, and the name of the databank to be shown in the project.

The new

![The Initialize Emmebank Tool](./InitEmmebank_screen.png)

# Running the RTM Phase 3 Model

![The RTM Phase 3 Model Run Tool](./FullModelRun_screen.png)

# Network Coding
## Extra Attributes

During a model run, a single master scenario is copied into 3 time of day specific scenarios for assignment.
The network parameters are coded in extra attributes in the master scenario and copied to the appropriate place
when the copies are made. A correspondence of from the master scenario to the time of day attributes is presented below.

|Master Scenario Attribute|     Time of Day Attributes    |
|:-----------------------:|:-------------------------------:|
|lanes                    |lanesam, lanesmd, lanespm |
|vdf                      |vdfam, vdfmd, vdfpm       |
|tpf                      |tpfam, tpfmd, tpfpm       |
|tolls                    |tollam, tollmd, tollpm    |
|hdwy                     |hdwyam, hdwymd, hdwypm    |

## Export Network Tool

Network coding should be done in the master scenarios only, as the time of day specific networks are overwritten
during each model run. The export network tool is responsible for exporting all required information from a scenario
for later import into the model run process.

![The Network Export Tool](./ExportNetwork_screen.png)
